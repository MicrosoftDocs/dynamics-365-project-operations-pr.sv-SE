---
title: Konfigurera automatiskt skapande av proforma-faktura
description: I det här ämnet finns information om hur du konfigurerar automatiskt skapande av proforma-fakturor.
author: rumant
manager: Annbe
ms.date: 10/13/2020
ms.topic: article
ms.service: dynamics-365-customerservice
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: e146dd510b3795d52d164fc6acf8e5400ba11310
ms.sourcegitcommit: 11a61db54119503e82faec5f99c4273e8d1247e5
ms.translationtype: HT
ms.contentlocale: sv-SE
ms.lasthandoff: 10/16/2020
ms.locfileid: "4085449"
---
# <a name="configure-automated-proforma-invoice-creation"></a><span data-ttu-id="04015-103">Konfigurera automatiskt skapande av proforma-faktura</span><span class="sxs-lookup"><span data-stu-id="04015-103">Configure automated proforma invoice creation</span></span>

<span data-ttu-id="04015-104">_**Gäller:** Enkel distribution – avtal till proforma-fakturering_</span><span class="sxs-lookup"><span data-stu-id="04015-104">_**Applies To:** Lite deployment - deal to proforma invoicing_</span></span>

<span data-ttu-id="04015-105">Du kan konfigurera automatiskt fakturaskapande i Dynamics 365 Project Operations.</span><span class="sxs-lookup"><span data-stu-id="04015-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="04015-106">Systemet skapar ett utkast till en proforma-faktura utifrån faktureringsschemat för varje projektkontrakt och kontraktrad.</span><span class="sxs-lookup"><span data-stu-id="04015-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="04015-107">Faktureringsscheman konfigureras på kontraktradsnivå.</span><span class="sxs-lookup"><span data-stu-id="04015-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="04015-108">Varje rad i ett kontrakt kan ha en särskild faktureringsplan, eller så kan samma faktureringsschema tas med på alla rader i kontraktet.</span><span class="sxs-lookup"><span data-stu-id="04015-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="04015-109">När du skapar en faktura skapas alltid minst en faktura per projektkontrakt.</span><span class="sxs-lookup"><span data-stu-id="04015-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="04015-110">I vissa fall kan flera fakturor skapas.</span><span class="sxs-lookup"><span data-stu-id="04015-110">In some cases, there may be multiple invoices created.</span></span>

<span data-ttu-id="04015-111">Om kontraktet till exempel har flera kunder skapas samma antal fakturor som antalet kunder som har fakturerbara transaktioner att fakturera på det projektkontraktet.</span><span class="sxs-lookup"><span data-stu-id="04015-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="04015-112">Förstå hur transaktioner tas med på en faktura</span><span class="sxs-lookup"><span data-stu-id="04015-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="04015-113">Ibland anges ett separat faktureringsschema för varje projektrelaterad kontraktrad.</span><span class="sxs-lookup"><span data-stu-id="04015-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="04015-114">Implementeringstjänster för Adatum-kontrakt har t.ex. följande kontraktrader:</span><span class="sxs-lookup"><span data-stu-id="04015-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="04015-115">Prototyparbete som är ett fast pris med två manuellt skapade milstolpar.</span><span class="sxs-lookup"><span data-stu-id="04015-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="04015-116">Implementeringsarbete som omfattar tid och debiteras varannan vecka på måndagar.</span><span class="sxs-lookup"><span data-stu-id="04015-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="04015-117">Utgifter som måste faktureras varje månad den första måndagen i varje månad.</span><span class="sxs-lookup"><span data-stu-id="04015-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="04015-118">Faktureringsscheman som har definierats på var och en av dessa två radartiklar ser ut som följande tabell:</span><span class="sxs-lookup"><span data-stu-id="04015-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="04015-119">Kontraktrad</span><span class="sxs-lookup"><span data-stu-id="04015-119">Contract line</span></span> | <span data-ttu-id="04015-120">Körningsdatum för faktura</span><span class="sxs-lookup"><span data-stu-id="04015-120">Invoice run date</span></span> | <span data-ttu-id="04015-121">Transaktionens slutdatum</span><span class="sxs-lookup"><span data-stu-id="04015-121">Transaction cut-off date</span></span> | <span data-ttu-id="04015-122">Milstolpens datum</span><span class="sxs-lookup"><span data-stu-id="04015-122">Milestone date</span></span> | <span data-ttu-id="04015-123">Milstolpebelopp</span><span class="sxs-lookup"><span data-stu-id="04015-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="04015-124">Prototyparbete</span><span class="sxs-lookup"><span data-stu-id="04015-124">Prototype work</span></span> | <span data-ttu-id="04015-125">5 oktober, måndag</span><span class="sxs-lookup"><span data-stu-id="04015-125">October 5, Monday</span></span> | - | <span data-ttu-id="04015-126">5 oktober, måndag</span><span class="sxs-lookup"><span data-stu-id="04015-126">October 5, Monday</span></span> | <span data-ttu-id="04015-127">5000 USD</span><span class="sxs-lookup"><span data-stu-id="04015-127">5000 USD</span></span> |
| - | <span data-ttu-id="04015-128">Tisdagen den 3 november</span><span class="sxs-lookup"><span data-stu-id="04015-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="04015-129">Tisdagen den 3 november</span><span class="sxs-lookup"><span data-stu-id="04015-129">November 3, Tuesday</span></span> | <span data-ttu-id="04015-130">12,000 USD</span><span class="sxs-lookup"><span data-stu-id="04015-130">12,000 USD</span></span> |
| <span data-ttu-id="04015-131">Implementeringsarbete</span><span class="sxs-lookup"><span data-stu-id="04015-131">Implementation work</span></span> | <span data-ttu-id="04015-132">5 oktober, måndag</span><span class="sxs-lookup"><span data-stu-id="04015-132">October 5, Monday</span></span> | <span data-ttu-id="04015-133">4 oktober, söndag</span><span class="sxs-lookup"><span data-stu-id="04015-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="04015-134">19 oktober, måndag</span><span class="sxs-lookup"><span data-stu-id="04015-134">October 19, Monday</span></span> | <span data-ttu-id="04015-135">18 oktober, söndag</span><span class="sxs-lookup"><span data-stu-id="04015-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="04015-136">Måndag 2 november</span><span class="sxs-lookup"><span data-stu-id="04015-136">November 2, Monday</span></span> | <span data-ttu-id="04015-137">Söndag 1 november</span><span class="sxs-lookup"><span data-stu-id="04015-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="04015-138">Måndag 16 november</span><span class="sxs-lookup"><span data-stu-id="04015-138">November 16, Monday</span></span> | <span data-ttu-id="04015-139">Söndag 15 november</span><span class="sxs-lookup"><span data-stu-id="04015-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="04015-140">Kostnader som uppstår</span><span class="sxs-lookup"><span data-stu-id="04015-140">Expenses incurred</span></span> | <span data-ttu-id="04015-141">5 oktober, måndag</span><span class="sxs-lookup"><span data-stu-id="04015-141">October 5, Monday</span></span> | <span data-ttu-id="04015-142">4 oktober, söndag</span><span class="sxs-lookup"><span data-stu-id="04015-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="04015-143">Måndag 2 november</span><span class="sxs-lookup"><span data-stu-id="04015-143">November 2, Monday</span></span> | <span data-ttu-id="04015-144">Söndag 1 november</span><span class="sxs-lookup"><span data-stu-id="04015-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="04015-145">I det här exemplet när automatisk fakturering körs för:</span><span class="sxs-lookup"><span data-stu-id="04015-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="04015-146">**4 oktober eller något tidigare datum** : Ingen faktura genereras för det här kontraktet eftersom tabellen **Faktureringsschema** för var och en av dessa kontraktrader inte svarar till söndag den 4 oktober som ett datum för fakturakörning.</span><span class="sxs-lookup"><span data-stu-id="04015-146">**October 4 or any date before** : No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="04015-147">**Måndagen den 5 oktober** : en faktura skapas för:</span><span class="sxs-lookup"><span data-stu-id="04015-147">**October 5 Monday** : One invoice is generated for:</span></span>

    - <span data-ttu-id="04015-148">Prototyparbete som innehåller milstolpen om den är markerad som **Klar för fakturering**.</span><span class="sxs-lookup"><span data-stu-id="04015-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="04015-149">Implementeringsarbete som omfattar alla tidstransaktioner som skapats före transaktionens avskärningsdatum söndagen den 4 oktober och som är markerat som **Klar för fakturering**.</span><span class="sxs-lookup"><span data-stu-id="04015-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="04015-150">Utgift som omfattar alla utgifttransaktioner som skapats före transaktionens avskärningsdatum söndagen den 4 oktober och som är markerat som **Klar för fakturering**.</span><span class="sxs-lookup"><span data-stu-id="04015-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="04015-151">**Den 6 oktober eller något datum för den 19 oktober** : Ingen faktura genereras för det här kontraktet eftersom tabellen **Faktureringsschema** för var och en av dessa kontraktrader inte svarar till den 6 oktober eller något datum före den 19 oktober som ett datum för fakturakörning.</span><span class="sxs-lookup"><span data-stu-id="04015-151">**On October 6 or any date before October 19** : No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="04015-152">**Mådagen den 19 oktober** : En faktura genereras för implementeringsarbete som omfattar alla tidstransaktioner som skapats före transaktionens avskärningsdatum söndagen den 18 oktober och som är markerat som **Klar för fakturering**.</span><span class="sxs-lookup"><span data-stu-id="04015-152">**October 19, Monday** : One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="04015-153">**Måndagen den 2 november** : en faktura skapas för:</span><span class="sxs-lookup"><span data-stu-id="04015-153">**November 2 Monday** : One invoice is generated for:</span></span>

    - <span data-ttu-id="04015-154">Implementeringsarbete som omfattar alla tidstransaktioner som skapats före transaktionens avskärningsdatum söndagen den 1 november och som är markerat som **Klar för fakturering**.</span><span class="sxs-lookup"><span data-stu-id="04015-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="04015-155">Utgift som omfattar alla utgifttransaktioner som skapats före transaktionens avskärningsdatum söndagen den 1 november och som är markerat som **Klar för fakturering**.</span><span class="sxs-lookup"><span data-stu-id="04015-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="04015-156">**Tisdagen den 3 november** : En faktura skapas för prototyparbete som innehåller milstolpen för 12 000 USD om den är markerad som **Klar för fakturering**.</span><span class="sxs-lookup"><span data-stu-id="04015-156">**November 3, Tuesday** : One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="04015-157">Konfigurera automatisk fakturering</span><span class="sxs-lookup"><span data-stu-id="04015-157">Configure automatic invoicing</span></span>

<span data-ttu-id="04015-158">Slutför stegen nedan om du vill konfigurera en automatisk fakturakörning.</span><span class="sxs-lookup"><span data-stu-id="04015-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="04015-159">I **Project Operations** går du till **Inställningar** > **Konfigurera återkommande faktura**.</span><span class="sxs-lookup"><span data-stu-id="04015-159">In **Project Operations** , go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="04015-160">Skapa ett batch-jobb och ge det namnet **Project Operations skapa fakturor**.</span><span class="sxs-lookup"><span data-stu-id="04015-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="04015-161">Namnet på batch-jobbet måste innehålla orden "skapa fakturor".</span><span class="sxs-lookup"><span data-stu-id="04015-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="04015-162">I fältet **Jobbtyp** , välj **Ingen**.</span><span class="sxs-lookup"><span data-stu-id="04015-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="04015-163">Som standard är fälten **Frekvens dagligen** och **Är aktiv** angivna som **Ja**.</span><span class="sxs-lookup"><span data-stu-id="04015-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="04015-164">Välj **Kör arbetsflöde**.</span><span class="sxs-lookup"><span data-stu-id="04015-164">Select **Run Workflow**.</span></span> <span data-ttu-id="04015-165">I dialogrutan **Sök efter post** visas tre arbetsflöden:</span><span class="sxs-lookup"><span data-stu-id="04015-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="04015-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="04015-166">ProcessRunCaller</span></span>
- <span data-ttu-id="04015-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="04015-167">ProcessRunner</span></span>
- <span data-ttu-id="04015-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="04015-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="04015-169">Välj **ProcessRunCaller** och välj **Lägg till**.</span><span class="sxs-lookup"><span data-stu-id="04015-169">Select **ProcessRunCaller** , and then select **Add**.</span></span>
6. <span data-ttu-id="04015-170">Klicka på **OK** i nästa dialogrutan.</span><span class="sxs-lookup"><span data-stu-id="04015-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="04015-171">Arbetsflödet **Vila** följs av **Process**.</span><span class="sxs-lookup"><span data-stu-id="04015-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="04015-172">Du kan också välja **ProcessRunner** i steg 5.</span><span class="sxs-lookup"><span data-stu-id="04015-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="04015-173">När du sedan väljer **OK** , följs arbetsflödet **Process** av arbetsflödet **Vila**.</span><span class="sxs-lookup"><span data-stu-id="04015-173">Then, when you select **OK** , a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="04015-174">Arbetsflödena **ProcessRunCaller** och **ProcessRunner** skapar fakturor.</span><span class="sxs-lookup"><span data-stu-id="04015-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="04015-175">**ProcessRunCaller** anropar **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="04015-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="04015-176">**ProcessRunner** är det arbetsflöde som verkligen skapade fakturorna.</span><span class="sxs-lookup"><span data-stu-id="04015-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="04015-177">Arbetsflödet går igenom alla kontraktrader som fakturorna måste skapas för och fakturor för dessa rader skapas.</span><span class="sxs-lookup"><span data-stu-id="04015-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="04015-178">För att fastställa vilka kontraktsrader som fakturor ska skapas tittar jobbet på körningsdatum för faktura för kontraktsraderna.</span><span class="sxs-lookup"><span data-stu-id="04015-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="04015-179">Om kontraktsrader som tillhör ett kontrakt har samma datum för fakturakörning kombineras transaktionerna till en faktura med två fakturarader.</span><span class="sxs-lookup"><span data-stu-id="04015-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="04015-180">Om det inte finns några transaktioner att skapa fakturor för hoppar jobbet över skapandet av fakturan.</span><span class="sxs-lookup"><span data-stu-id="04015-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="04015-181">När **ProcessRunner** har körts klart anropas **ProcessRunCaller** , anger sluttiden och är stängd.</span><span class="sxs-lookup"><span data-stu-id="04015-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller** , provides the end time, and is closed.</span></span> <span data-ttu-id="04015-182">**ProcessRunCaller** startar sedan en timer som körs i 24 timmar från den angivna sluttiden.</span><span class="sxs-lookup"><span data-stu-id="04015-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="04015-183">**ProcessRunCaller** stängs i slutet av timern.</span><span class="sxs-lookup"><span data-stu-id="04015-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="04015-184">Batchprocessjobbet för att skapa fakturor är ett återkommande jobb.</span><span class="sxs-lookup"><span data-stu-id="04015-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="04015-185">Om batchprocessen körs flera gånger skapas flera instanser av jobbet och det uppstår fel.</span><span class="sxs-lookup"><span data-stu-id="04015-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="04015-186">Därför bör du endast starta batchprocessen en gång och du bör sedan starta om den endast om den slutar att fungera.</span><span class="sxs-lookup"><span data-stu-id="04015-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="04015-187">Batchfakturering i Project Operations körs endast för projektkontraktrader som konfigurerats av fakturascheman.</span><span class="sxs-lookup"><span data-stu-id="04015-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="04015-188">En kontraktrad med en fast pris faktureringsmetod måste ha milstolpar konfigurerad.</span><span class="sxs-lookup"><span data-stu-id="04015-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="04015-189">En projekts kontraktrad med en tids- och material faktureringsmetod måste ha en datumbaserad fakturauppställning.</span><span class="sxs-lookup"><span data-stu-id="04015-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>
